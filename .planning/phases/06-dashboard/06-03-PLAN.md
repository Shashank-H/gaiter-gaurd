---
phase: 06-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - frontend/src/routes/_auth/services/index.tsx
  - frontend/src/routes/_auth/services/new.tsx
  - frontend/src/routes/_auth/services/$id.edit.tsx
  - frontend/src/hooks/useServices.ts
  - frontend/src/components/services/ServiceCard.tsx
  - frontend/src/components/services/ServiceForm.tsx
  - frontend/src/components/services/CredentialForm.tsx
autonomous: false
requirements:
  - DASH-02

must_haves:
  truths:
    - "User can see a list of their registered services"
    - "User can create a new service with name, base URL, and auth type"
    - "User can edit an existing service"
    - "User can delete a service with confirmation"
    - "User can add/update credentials for a service"
  artifacts:
    - path: "frontend/src/routes/_auth/services/index.tsx"
      provides: "Services list page"
      contains: "useServices"
    - path: "frontend/src/routes/_auth/services/new.tsx"
      provides: "Create service form page"
      contains: "createService"
    - path: "frontend/src/routes/_auth/services/$id.edit.tsx"
      provides: "Edit service form page"
      contains: "updateService"
    - path: "frontend/src/hooks/useServices.ts"
      provides: "TanStack Query hooks for services CRUD"
      exports: ["useServices", "useCreateService", "useUpdateService", "useDeleteService", "useUpsertCredentials"]
    - path: "frontend/src/components/services/ServiceForm.tsx"
      provides: "Reusable service form for create and edit"
      contains: "authType"
  key_links:
    - from: "frontend/src/routes/_auth/services/index.tsx"
      to: "frontend/src/hooks/useServices.ts"
      via: "useServices hook"
      pattern: "useServices"
    - from: "frontend/src/hooks/useServices.ts"
      to: "frontend/src/api/endpoints.ts"
      via: "api.listServices, createService, updateService, deleteService"
      pattern: "api\\.(list|create|update|delete)Service"
---

<objective>
Service management pages: list, create, edit, delete services and manage credentials through the dashboard UI.

Purpose: DASH-02 requires users to manage services and their API keys through the web dashboard. The backend CRUD endpoints already exist from Phase 2. This plan builds the UI pages that consume them.

Output: /services list page, /services/new create form, /services/:id/edit edit form, credential management within service forms, and delete confirmation flow.
</objective>

<execution_context>
@/home/shashank/.claude/get-shit-done/workflows/execute-plan.md
@/home/shashank/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-dashboard/06-RESEARCH.md
@.planning/phases/06-dashboard/06-01-SUMMARY.md
@backend/src/routes/services.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Service hooks and components</name>
  <files>
    frontend/src/hooks/useServices.ts
    frontend/src/components/services/ServiceCard.tsx
    frontend/src/components/services/ServiceForm.tsx
    frontend/src/components/services/CredentialForm.tsx
  </files>
  <action>
**useServices.ts** — TanStack Query hooks for service CRUD:
- `useServices()` — `useQuery` with queryKey `['services']`, calls `api.listServices()`, select `data.services`
- `useCreateService()` — `useMutation` calling `api.createService(data)`, invalidates `['services']` on success
- `useUpdateService()` — `useMutation` calling `api.updateService(id, data)`, invalidates `['services']` on success
- `useDeleteService()` — `useMutation` calling `api.deleteService(id)`, optimistically removes from cache, invalidates on error
- `useUpsertCredentials()` — `useMutation` calling `api.upsertCredentials(id, data)`, invalidates `['services']` on success
- Export `ServiceType` matching backend: `{ id: number, name: string, baseUrl: string, authType: string, createdAt: string, updatedAt: string }`

Use `frontend-design` skill for ALL components. Vercel-style dark aesthetic.

**ServiceCard.tsx** — card for each service in the list:
- Props: `service: ServiceType`, `onEdit: () => void`, `onDelete: () => void`
- oat.ink `<article class="card">` layout
- Header: service name as `<h3>`, auth type Badge (bearer=info, api_key=warning, basic=danger, oauth2=primary)
- Content: base URL in monospace, created date
- Footer: Edit button (ghost variant) and Delete button (danger variant)

**ServiceForm.tsx** — reusable form for create AND edit:
- Props: `defaultValues?: Partial<ServiceType>`, `onSubmit: (data) => void`, `isSubmitting: boolean`
- Fields: name (text input, required), baseUrl (url input, required), authType (select: api_key, bearer, basic, oauth2)
- oat.ink semantic form elements: `<form>`, `<label>`, `<input>`, `<select>`, `<button>`
- Submit button shows loading state when `isSubmitting`
- Client-side validation: name required (3-255 chars), baseUrl must start with https:// or http://

**CredentialForm.tsx** — credential management within edit page:
- Props: `serviceId: number`, `authType: string`
- Dynamic fields based on authType:
  - `api_key`: single field "API Key"
  - `bearer`: single field "Bearer Token"
  - `basic`: two fields "Username" and "Password"
  - `oauth2`: fields "Client ID", "Client Secret", "Token URL"
- Each credential field is a key-value pair: key is fixed by authType, value is password input
- Submit calls `useUpsertCredentials` mutation with array of `{ key, value }` pairs
- Show "Credentials saved" success message on mutation success
- Note to user: "Credentials are encrypted at rest. Values cannot be retrieved after saving."
  </action>
  <verify>
TypeScript compiles: `cd frontend && bunx tsc --noEmit`. All hooks export: `grep "export function use" frontend/src/hooks/useServices.ts`. ServiceForm handles all 4 auth types: `grep "api_key\|bearer\|basic\|oauth2" frontend/src/components/services/ServiceForm.tsx`.
  </verify>
  <done>
5 TanStack Query hooks for services CRUD + credentials. ServiceCard, ServiceForm (create/edit reusable), and CredentialForm (dynamic fields by auth type) components. All compile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Service management route pages and navigation</name>
  <files>
    frontend/src/routes/_auth/services/index.tsx
    frontend/src/routes/_auth/services/new.tsx
    frontend/src/routes/_auth/services/$id.edit.tsx
  </files>
  <action>
Use `frontend-design` skill for ALL pages. Vercel-style dark aesthetic.

**services/index.tsx** — services list page:
- Create as TanStack Router file route: `createFileRoute('/_auth/services/')`
- Page header: "Services" heading with "Add Service" Button (primary variant, links to /services/new)
- Use `useServices()` hook
- Loading state: 3 Skeleton cards
- Empty state: "No services registered yet" with call-to-action to add first service
- Data state: grid of ServiceCard components (responsive: 1 col mobile, 2 cols tablet, 3 cols desktop using CSS grid)
- Delete flow: clicking delete on ServiceCard shows Modal confirmation ("Delete service X? This will also delete all credentials and agent access."). On confirm, call `useDeleteService` mutation.

**services/new.tsx** — create service page:
- Create as TanStack Router file route: `createFileRoute('/_auth/services/new')`
- Page header: "Register Service" with back link to /services
- Render `<ServiceForm>` with no defaultValues
- On submit: call `useCreateService` mutation, on success navigate to /services

**services/$id.edit.tsx** — edit service page:
- Create as TanStack Router file route: `createFileRoute('/_auth/services/$id/edit')`
- Load service data using `useQuery` with queryKey `['services', id]` — either filter from list cache or add a getService endpoint call
- Page header: "Edit {service.name}" with back link to /services
- Render `<ServiceForm>` with service data as defaultValues
- On submit: call `useUpdateService` mutation, on success navigate to /services
- Below the service form, render `<CredentialForm serviceId={id} authType={service.authType} />`
- Visual separator between service details and credential management sections

Add navigation links: in the auth layout (`_auth.tsx`) or root layout, add a nav bar with links to "Queue" (/queue) and "Services" (/services). Use oat.ink `<nav>` with `<menu>` semantic HTML. Highlight active route. Include a logout button that clears the token and redirects to /login.
  </action>
  <verify>
TypeScript compiles: `cd frontend && bunx tsc --noEmit`. Frontend dev server starts. Visit /services — should render services list page. Visit /services/new — should render create form. Navigation between Queue and Services works. Verify nav exists: `grep "nav\|menu" frontend/src/routes/_auth.tsx` or root layout.
  </verify>
  <done>
Services list at /services with grid layout, create form at /services/new, edit form at /services/:id/edit with credential management. Delete confirmation modal. Navigation bar with Queue and Services links plus logout. All pages use oat.ink semantic HTML with Vercel dark theme.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of complete dashboard</name>
  <action>
Human verifies the complete GaiterGuard dashboard: login, approval queue with swipe cards, and service management UI.

Steps to verify:
1. Start backend: `cd backend && bun run dev` (ensure PostgreSQL is running)
2. Start frontend: `cd frontend && bun run dev`
3. Open browser to frontend URL (likely http://localhost:3000 or http://localhost:5173)
4. Verify: Login page renders with dark theme
5. Log in with your credentials (register first if needed via backend API)
6. Verify: Redirected to /queue (approval queue)
7. Verify: Queue shows empty state if no pending actions, or cards if pending actions exist
8. If cards exist: try swiping right (approve) and left (deny) on mobile/touch, or use buttons on desktop
9. Navigate to /services via nav bar
10. Verify: Services list page renders
11. Click "Add Service" — verify create form works
12. Edit a service — verify credential form shows correct fields for auth type
13. Delete a service — verify confirmation modal appears
14. Verify: Dark theme consistent across all pages
  </action>
  <verify>Human confirms all pages render correctly with dark theme and functional interactions.</verify>
  <done>Human has verified the dashboard works end-to-end: login, approval queue, service management, dark theme.</done>
</task>

</tasks>

<verification>
1. Frontend compiles: `cd frontend && bunx tsc --noEmit`
2. Services list page at /services with grid layout
3. Create service form at /services/new
4. Edit service form at /services/:id/edit with credential management
5. Delete confirmation modal works
6. Navigation bar with Queue and Services links
7. Logout clears token and redirects to /login
8. All pages use oat.ink semantic HTML with dark theme
</verification>

<success_criteria>
- /services lists registered services in responsive grid
- /services/new creates a service with name, baseUrl, authType
- /services/:id/edit updates service details and manages credentials
- Delete shows confirmation modal, then removes service
- Credential form adapts fields based on auth type
- Navigation between Queue and Services works
- Visual verification by human confirms dark theme and UX quality
</success_criteria>

<output>
After completion, create `.planning/phases/06-dashboard/06-03-SUMMARY.md`
</output>
