---
phase: 06.1-agent-management-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/api/endpoints.ts
  - frontend/src/hooks/useAgents.ts
  - frontend/src/components/agents/AgentCard.tsx
  - frontend/src/routes/_auth.tsx
  - frontend/src/routes/_auth/agents/index.tsx
autonomous: true
requirements:
  - DASH-03

must_haves:
  truths:
    - "User can navigate to /agents/ from the nav bar"
    - "User can see all active agents as cards with name, status badge, key prefix, last-used, and service tags"
    - "Active and revoked agents are displayed in separate sections"
    - "Revoked agents section is collapsed by default"
    - "Empty state shows a CTA card with 'Create your first agent' button"
    - "Loading state shows skeleton cards"
  artifacts:
    - path: "frontend/src/api/endpoints.ts"
      provides: "Agent API methods on the api object"
      contains: "listAgents"
    - path: "frontend/src/hooks/useAgents.ts"
      provides: "useAgents query hook plus mutation hooks"
      exports: ["useAgents", "useCreateAgent", "useUpdateAgent", "useDeleteAgent", "useUpdateAgentServices", "useRevokeAgent"]
    - path: "frontend/src/components/agents/AgentCard.tsx"
      provides: "Card component for single agent display"
      exports: ["AgentCard"]
    - path: "frontend/src/routes/_auth/agents/index.tsx"
      provides: "Agents list page with active/revoked sections"
      contains: "createFileRoute"
    - path: "frontend/src/routes/_auth.tsx"
      provides: "Agents nav link in auth layout"
      contains: "agents"
  key_links:
    - from: "frontend/src/routes/_auth/agents/index.tsx"
      to: "frontend/src/hooks/useAgents.ts"
      via: "useAgents() hook call"
      pattern: "useAgents\\(\\)"
    - from: "frontend/src/hooks/useAgents.ts"
      to: "frontend/src/api/endpoints.ts"
      via: "api.listAgents in queryFn"
      pattern: "api\\.listAgents"
    - from: "frontend/src/routes/_auth/agents/index.tsx"
      to: "frontend/src/components/agents/AgentCard.tsx"
      via: "AgentCard component rendering"
      pattern: "<AgentCard"
    - from: "frontend/src/routes/_auth.tsx"
      to: "/agents/"
      via: "Link component in nav"
      pattern: "to=\"/agents/\""
---

<objective>
Agent API layer, data hooks, card component, nav link, and list page with active/revoked sections.

Purpose: Establishes the read-only data pipeline and list view so users can see all their agents. This is the foundation for all mutation flows in Plan 02.
Output: Working /agents/ page showing agent cards in active/revoked sections, plus all API methods and hooks needed by subsequent plans.
</objective>

<execution_context>
@/home/shashank/.claude/get-shit-done/workflows/execute-plan.md
@/home/shashank/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-agent-management-ui/06.1-RESEARCH.md

@frontend/src/api/endpoints.ts
@frontend/src/hooks/useServices.ts
@frontend/src/components/services/ServiceCard.tsx
@frontend/src/routes/_auth.tsx
@frontend/src/routes/_auth/services/index.tsx
@frontend/src/components/primitives/Badge.tsx
@frontend/src/components/primitives/Button.tsx
@frontend/src/components/primitives/Skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Agent API endpoints and data hooks</name>
  <files>
    frontend/src/api/endpoints.ts
    frontend/src/hooks/useAgents.ts
  </files>
  <action>
1. In `frontend/src/api/endpoints.ts`, add these methods to the `api` object (after the services section):

- `listAgents`: GET /agents, returns `Promise<AgentType[]>` (response is a direct array)
- `createAgent`: POST /agents with `{ name: string, serviceIds: number[] }`, returns `Promise<{ agent: AgentType, apiKey: string }>`
- `getAgent`: GET /agents/:id, returns single AgentType (with updatedAt)
- `updateAgent`: PUT /agents/:id with `{ name?: string, isActive?: boolean }`, returns AgentType
- `deleteAgent`: DELETE /agents/:id, returns void (just authedFetch, no .json())
- `updateAgentServices`: PUT /agents/:id/services with `{ serviceIds: number[] }`, returns `Promise<{ message: string, services: Array<{id: number, name: string}> }>`

Also add the `AgentType` interface export at the bottom of the file (next to PendingApproval):
```
export interface AgentType {
  id: number;
  name: string;
  keyPrefix: string;
  isActive: boolean;
  lastUsedAt: string | null;
  createdAt: string;
  updatedAt?: string;
  services: Array<{ id: number; name: string }>;
}
```

2. Create `frontend/src/hooks/useAgents.ts` mirroring the useServices.ts pattern exactly. Export:

- `useAgents()` — useQuery with queryKey `['agents']`, queryFn calls `api.listAgents()`, select ensures array return
- `useAgent(id: number)` — useQuery with queryKey `['agents', id]`, queryFn calls `api.getAgent(id)`, enabled only when id > 0
- `useCreateAgent()` — useMutation calling `api.createAgent(data)`, onSettled invalidates `['agents']`. Do NOT put apiKey in cache.
- `useUpdateAgent()` — useMutation calling `api.updateAgent(id, data)` with optimistic update (update name/isActive in cache), onSettled invalidates `['agents']`
- `useRevokeAgent()` — useMutation calling `api.updateAgent(id, { isActive: false })` with optimistic update that sets isActive to false in the agents list cache. Follow the useDeleteService pattern but update the field instead of filtering out.
- `useReactivateAgent()` — useMutation calling `api.updateAgent(id, { isActive: true })` with optimistic update setting isActive to true
- `useDeleteAgent()` — useMutation calling `api.deleteAgent(id)` with optimistic removal from cache (filter out by id), revert on error. Follow useDeleteService pattern exactly.
- `useUpdateAgentServices()` — useMutation calling `api.updateAgentServices(id, serviceIds)`, onSettled invalidates `['agents']` and `['agents', id]`

Import AgentType from `@/api/endpoints`. Use `AGENTS_QUERY_KEY = ['agents'] as const`.
  </action>
  <verify>
TypeScript compilation: `cd /home/shashank/personal/gaiter-gaurd/frontend && npx tsc --noEmit --pretty 2>&1 | head -30` — no errors in endpoints.ts or useAgents.ts
  </verify>
  <done>
All 6 API methods exist on the api object. All 8 hooks are exported from useAgents.ts. AgentType interface is exported from endpoints.ts. TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: AgentCard component and agents list page with nav link</name>
  <files>
    frontend/src/components/agents/AgentCard.tsx
    frontend/src/routes/_auth/agents/index.tsx
    frontend/src/routes/_auth.tsx
  </files>
  <action>
1. Create `frontend/src/components/agents/AgentCard.tsx`:

Mirror the research-provided AgentCard skeleton exactly. Props interface:
```
interface AgentCardProps {
  agent: AgentType;
  onEdit: () => void;
  onRevoke?: () => void;      // only for active agents
  onReactivate?: () => void;  // only for revoked agents
  onDelete?: () => void;      // only for revoked agents
}
```

Card structure (using `<article className="card">` to match approval queue visual style):
- Header: agent name (h3) + Badge (variant="success" for active, variant="danger" for revoked)
- Body: key prefix in monospace (`{agent.keyPrefix}...`), last-used timestamp or "Never used"
- Service tags: small styled spans showing each service name (use the inline style pattern from research)
- Footer with border-top:
  - Active agents: "Edit" (ghost) + "Revoke" (danger) buttons
  - Revoked agents: "Re-activate" (ghost) + "Delete" (danger) buttons

Import Badge and Button from primitives. Import AgentType from `@/api/endpoints`.

2. Create `frontend/src/routes/_auth/agents/index.tsx`:

Follow the services/index.tsx pattern. Components:
- `createFileRoute('/_auth/agents/')` with component AgentsPage
- Use `useAgents()` for data, `useRevokeAgent()`, `useReactivateAgent()`, `useDeleteAgent()` for mutations
- Split agents into `activeAgents` and `revokedAgents` using `.filter(a => a.isActive)` / `.filter(a => !a.isActive)`
- `useNavigate()` for navigation to edit/create pages

Page layout (max-width 1200px container, matching services page):
- Header section: "Agents" h1 + "Create Agent" primary Button linking to `/agents/new`
- Loading state: 3 Skeleton cards in the grid (use Skeleton component)
- Error state: simple error message
- Empty state (no agents at all): centered CTA card with icon and "Create your first agent" button (per locked decision)
- Active agents section: CSS grid (3 columns on large, 2 on medium, 1 on small using `grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))`) rendering AgentCard for each
- Revoked agents section: only shown if revokedAgents.length > 0. Use a `<details>` element (closed by default per locked decision) with `<summary>` "Revoked Agents ({count})". Inside: same grid of AgentCard components with revoked variant buttons.
- Revoke confirmation: Modal with danger text "Revoke access for {name}? The agent's API key will stop working immediately. You can re-activate later."
- Delete confirmation: Modal with danger text "Permanently delete {name}? This cannot be undone."
- Track `agentToRevoke` and `agentToDelete` in useState for modal targets

Import useNavigate from @tanstack/react-router. Import Modal from primitives.

3. In `frontend/src/routes/_auth.tsx`:

Add an "Agents" nav link after the Services `<li>` block. Follow the exact same pattern as the Services link but with `to="/agents/"` and `isActive('/agents')`. The text should be "Agents".
  </action>
  <verify>
TypeScript compilation: `cd /home/shashank/personal/gaiter-gaurd/frontend && npx tsc --noEmit --pretty 2>&1 | head -30` — no errors.
Start dev server briefly to confirm route generation: `cd /home/shashank/personal/gaiter-gaurd/frontend && timeout 15 npx vite build 2>&1 | tail -10` — builds without errors.
  </verify>
  <done>
AgentCard renders agent name, status badge, key prefix, last-used, service tags, and appropriate action buttons for active/revoked states. Agents list page shows active cards in a grid, revoked section collapsed by default via details/summary, empty CTA state, loading skeletons, and confirmation modals for revoke/delete. Nav bar has "Agents" link between Services and logout.
  </done>
</task>

</tasks>

<verification>
- Navigation: /agents/ link appears in nav bar and navigates to agents list page
- Data flow: useAgents() fetches from api.listAgents() which calls GET /agents
- Card display: AgentCard shows name, Badge status, keyPrefix in monospace, lastUsedAt, service tags
- Sections: Active agents grid + collapsed revoked details section
- Empty state: CTA card when no agents exist
- Loading: Skeleton cards during fetch
- Mutations: Revoke and delete have confirmation modals with optimistic updates
</verification>

<success_criteria>
1. /agents/ page renders with agent cards showing all required info (name, status, key prefix, last used, services)
2. Active and revoked agents in separate sections, revoked collapsed by default
3. Empty state shows CTA card
4. Nav bar includes Agents link
5. All API methods and hooks compile without TypeScript errors
6. Revoke/delete modals with optimistic cache updates
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-agent-management-ui/06.1-01-SUMMARY.md`
</output>
