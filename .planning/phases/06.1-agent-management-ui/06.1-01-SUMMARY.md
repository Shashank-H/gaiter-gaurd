---
phase: 06.1-agent-management-ui
plan: 01
subsystem: ui
tags: [react, tanstack-query, tanstack-router, typescript]

# Dependency graph
requires:
  - phase: 06-dashboard
    provides: Services list page pattern, primitives (Badge, Button, Modal, Skeleton), useServices hook, _auth.tsx nav layout
  - phase: 03-agent-authentication
    provides: Agent API endpoints (GET/POST/PUT/DELETE /agents, PUT /agents/:id/services) and AgentType schema

provides:
  - Agent API methods on the api object (listAgents, createAgent, getAgent, updateAgent, deleteAgent, updateAgentServices)
  - AgentType interface exported from endpoints.ts
  - useAgents.ts with 8 hooks: useAgents, useAgent, useCreateAgent, useUpdateAgent, useRevokeAgent, useReactivateAgent, useDeleteAgent, useUpdateAgentServices
  - AgentCard.tsx card component for single agent display
  - /agents/ list page with active/revoked sections, empty state, loading skeletons, confirmation modals
  - Agents nav link in _auth.tsx nav bar

affects:
  - 06.1-02 (create/edit forms use useCreateAgent, useUpdateAgent, useUpdateAgentServices hooks)
  - 06.1-03 (any additional agent pages use AgentCard and useAgents hooks)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "AgentType interface co-located with API methods in endpoints.ts (same pattern as PendingApproval)"
    - "useAgents.ts mirrors useServices.ts pattern with optimistic mutations for revoke/delete/reactivate"
    - "Agents list uses <details>/<summary> for collapsed revoked section (HTML native, no JS state)"
    - "Future routes cast as 'never' to satisfy TypeScript until routeTree.gen.ts regenerates on dev run"

key-files:
  created:
    - frontend/src/hooks/useAgents.ts
    - frontend/src/components/agents/AgentCard.tsx
    - frontend/src/routes/_auth/agents/index.tsx
  modified:
    - frontend/src/api/endpoints.ts
    - frontend/src/routes/_auth.tsx

key-decisions:
  - "AgentType interface exported from endpoints.ts (not useAgents.ts) to avoid circular imports with API methods"
  - "Revoked agents section uses native <details>/<summary> element for collapse (collapsed by default, no state needed)"
  - "Optimistic mutations for revoke/reactivate update isActive field in-place (not filter/add) to preserve cache integrity"
  - "Future route links (/agents/new, /agents/$id/edit) cast as 'never' — routes created in Plan 02, routeTree regenerates on dev run"

patterns-established:
  - "AgentCard: <article class='card'> with header/body/service-tags/footer structure matching ServiceCard"
  - "Two-section list: active agents always visible, revoked agents in <details> collapsed by default"
  - "Confirmation modals for destructive actions (revoke and delete both require confirmation)"

requirements-completed:
  - DASH-03

# Metrics
duration: 4min
completed: 2026-02-18
---

# Phase 06.1 Plan 01: Agent API Layer, Hooks, Card, and List Page Summary

**Agent read pipeline: 6 API methods, 8 TanStack Query hooks, AgentCard component, and /agents/ list page with active/revoked sections using <details> collapse**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-18T06:17:07Z
- **Completed:** 2026-02-18T06:21:00Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments

- Full agent API layer: 6 methods on `api` object covering CRUD and service-scope update
- 8 TanStack Query hooks with optimistic mutations for revoke (field update), reactivate (field update), and delete (filter)
- AgentCard component displaying name, status badge (success/danger), key prefix in monospace, last-used date, service tags, and action buttons
- /agents/ page with active section grid, revoked section collapsed via `<details>`, empty CTA state, 3-skeleton loading state, and confirmation modals for revoke/delete
- Agents nav link added to nav bar between Services and logout

## Task Commits

Each task was committed atomically:

1. **Task 1: Agent API endpoints and data hooks** - `6b17ced` (feat)
2. **Task 2: AgentCard component and agents list page with nav link** - `a6b8aa2` (feat)

## Files Created/Modified

- `frontend/src/api/endpoints.ts` - Added AgentType interface and 6 agent API methods
- `frontend/src/hooks/useAgents.ts` - Created with 8 hooks: useAgents, useAgent, useCreateAgent, useUpdateAgent, useRevokeAgent, useReactivateAgent, useDeleteAgent, useUpdateAgentServices
- `frontend/src/components/agents/AgentCard.tsx` - Card component for single agent display with active/revoked button variants
- `frontend/src/routes/_auth/agents/index.tsx` - Agents list page with active/revoked sections, empty state, skeletons, modals
- `frontend/src/routes/_auth.tsx` - Added Agents nav link after Services

## Decisions Made

- AgentType exported from `endpoints.ts` alongside the API methods that use it (avoids circular import if it were in useAgents.ts and useAgents.ts imported from endpoints.ts)
- Used native `<details>/<summary>` for revoked section collapse per the plan's locked decision — no React state needed, browser handles it, closed by default
- Cast future route paths (`/agents/new`, `/agents/$id/edit`) as `never` to satisfy TypeScript — these routes will exist after Plan 02 creates the route files and routeTree.gen.ts regenerates

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] TypeScript errors for missing future routes**
- **Found during:** Task 2 (agents list page)
- **Issue:** `to="/agents/new"` and `to="/agents/$id/edit"` caused TS errors because these routes don't exist in routeTree.gen.ts yet (Plan 02 creates them)
- **Fix:** Cast route paths as `never` with inline comment explaining they will exist after Plan 02
- **Files modified:** frontend/src/routes/_auth/agents/index.tsx
- **Verification:** Vite build completes without errors (`bunx vite build`)
- **Committed in:** a6b8aa2 (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (TypeScript type assertion for future routes)
**Impact on plan:** Necessary for build success; routes will resolve correctly at runtime and TS will be satisfied once Plan 02 creates the route files.

## Issues Encountered

- Pre-existing TypeScript error in codebase: `to="/services/"` in `_auth.tsx` and services edit/new pages (trailing slash vs router's `to: '/services'`). These are pre-existing issues outside plan scope. The new `to="/agents/"` follows the same established pattern and has same pre-existing TS behavior.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- All hooks and API methods are ready for Plan 02 (create/edit forms) to use
- `useCreateAgent`, `useUpdateAgent`, `useUpdateAgentServices` are implemented and ready
- AgentCard will need no changes — edit button navigates to `/agents/$id/edit` which Plan 02 creates
- routeTree.gen.ts will auto-regenerate when dev server starts with new route files

## Self-Check: PASSED

All files created and commits verified:
- FOUND: frontend/src/api/endpoints.ts
- FOUND: frontend/src/hooks/useAgents.ts
- FOUND: frontend/src/components/agents/AgentCard.tsx
- FOUND: frontend/src/routes/_auth/agents/index.tsx
- FOUND: commit 6b17ced (feat: agent API endpoints and data hooks)
- FOUND: commit a6b8aa2 (feat: AgentCard component, agents list page, nav link)

---
*Phase: 06.1-agent-management-ui*
*Completed: 2026-02-18*
